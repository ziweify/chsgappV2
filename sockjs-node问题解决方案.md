# sockjs-node æ¥å£æ— æ³•è®¿é—®é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜ç°è±¡

åœ¨ HBuilderX ä¸­è¿è¡Œ chsgappV2 é¡¹ç›®æ—¶ï¼Œç»å¸¸çœ‹åˆ°ä»¥ä¸‹è¯·æ±‚å¤±è´¥ï¼š
```
http://h5.chsg.com:8080/sockjs-node/info?t=1767911874907
```

## é—®é¢˜åŸå› 

### sockjs-node æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ **webpack-dev-server** çš„ **çƒ­æ¨¡å—æ›¿æ¢(HMR)** åŠŸèƒ½ä½¿ç”¨çš„ WebSocket è¿æ¥æ¥å£ã€‚

### ä½œç”¨

1. **ä»£ç çƒ­æ›´æ–°**ï¼šä¿®æ”¹ä»£ç åè‡ªåŠ¨åˆ·æ–°é¡µé¢æˆ–å±€éƒ¨æ›´æ–°ç»„ä»¶
2. **å¼€å‘ä½“éªŒä¼˜åŒ–**ï¼šå®æ—¶åŒæ­¥ä»£ç å˜åŒ–åˆ°æµè§ˆå™¨
3. **çŠ¶æ€ä¿æŒ**ï¼šæ›´æ–°ä»£ç æ—¶ä¿æŒåº”ç”¨çŠ¶æ€

### ä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Ÿ

é…ç½®äº† `public: 'h5.chsg.com:8080'`ï¼Œä½†è¿™ä¸ªåŸŸååªåœ¨æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶å¯ç”¨ï¼š
1. å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆHBuilderX è¿è¡Œæˆ– npm run devï¼‰
2. hosts æ–‡ä»¶é…ç½®äº† `127.0.0.1 h5.chsg.com`
3. é€šè¿‡ `h5.chsg.com:8080` è®¿é—®é¡µé¢

å¦‚æœé€šè¿‡å…¶ä»–æ–¹å¼è®¿é—®ï¼ˆå¦‚ç›´æ¥æ‰“å¼€æ–‡ä»¶ã€ä½¿ç”¨ localhost ç­‰ï¼‰ï¼ŒHMR ä¼šå°è¯•è¿æ¥é…ç½®çš„åŸŸåè€Œå¤±è´¥ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆå·²ä¿®å¤ï¼‰

### ä¿®æ”¹å†…å®¹

å·²å°†é…ç½®æ”¹ä¸ºæ³¨é‡ŠçŠ¶æ€ï¼Œé»˜è®¤ä½¿ç”¨ localhostï¼š

#### 1. vue.config.js
```javascript
module.exports = {
  devServer: {
    host: '0.0.0.0',
    port: 8080,
    disableHostCheck: true,
    // public: 'h5.chsg.com:8080',  // å·²æ³¨é‡Šï¼Œä½¿ç”¨ localhost
    proxy: {
      '/api': {
        target: 'http://adm.jys.com',
        changeOrigin: true,
        pathRewrite: { '^/api': '' },
      },
    },
  },
};
```

#### 2. manifest.json
```json
{
  "h5": {
    "devServer": {
      "https": false,
      "host": "0.0.0.0",
      "port": 8080,
      "disableHostCheck": true
      // å·²åˆ é™¤ "public": "h5.chsg.com:8080"
    }
  }
}
```

### ä½¿ç”¨æ–¹å¼

**ç°åœ¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼ŒHMR éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼š**
- âœ… `http://localhost:8080/`
- âœ… `http://127.0.0.1:8080/`
- âœ… `http://192.168.x.x:8080/` (å±€åŸŸç½‘IP)

---

## ğŸ”„ é‡å¯ç”Ÿæ•ˆ

ä¿®æ”¹é…ç½®åï¼Œéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨ï¼š

### æ–¹æ³•1ï¼šHBuilderX
1. åœæ­¢å½“å‰è¿è¡Œï¼ˆç‚¹å‡»åœæ­¢æŒ‰é’®ï¼‰
2. é‡æ–°è¿è¡Œåˆ°æµè§ˆå™¨

### æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ
```bash
# åœæ­¢å½“å‰è¿›ç¨‹ï¼ˆCtrl+Cï¼‰
# é‡æ–°è¿è¡Œ
npm run dev:h5
```

---

## ğŸ“ éªŒè¯ä¿®å¤

ä¿®å¤åï¼Œè§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°ï¼š

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰
```
GET http://h5.chsg.com:8080/sockjs-node/info?t=xxx 
âŒ net::ERR_NAME_NOT_RESOLVED
```

### ä¿®å¤åï¼ˆæ­£å¸¸ï¼‰
```
WebSocket connection to 'ws://localhost:8080/sockjs-node/xxx'
âœ… WebSocket is already in CONNECTING or OPEN state
```

---

## ğŸ¯ ä¸åŒåœºæ™¯çš„é…ç½®

### åœºæ™¯1ï¼šæœ¬åœ°å¼€å‘ï¼ˆæ¨èï¼Œå·²é…ç½®ï¼‰
```javascript
// ä¸é…ç½® publicï¼Œè‡ªåŠ¨ä½¿ç”¨å½“å‰è®¿é—®çš„åŸŸå
module.exports = {
  devServer: {
    host: '0.0.0.0',
    port: 8080,
    disableHostCheck: true,
  },
};
```

### åœºæ™¯2ï¼šéœ€è¦å›ºå®šåŸŸåè°ƒè¯•
```javascript
// ä½¿ç”¨å‰éœ€è¦é…ç½® hostsï¼š127.0.0.1 h5.chsg.com
module.exports = {
  devServer: {
    host: '0.0.0.0',
    port: 8080,
    disableHostCheck: true,
    public: 'h5.chsg.com:8080',
  },
};
```

### åœºæ™¯3ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼Œä¸éœ€è¦ HMR
npm run build:h5
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ä¿®æ”¹åè¿˜æ˜¯æŠ¥é”™ï¼Ÿ
**A**: éœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨ï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆã€‚

### Q2: HMR çƒ­æ›´æ–°ä¸å·¥ä½œï¼Ÿ
**A**: æ£€æŸ¥ï¼š
1. å¼€å‘æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ WebSocket è¿æ¥é”™è¯¯
3. æ˜¯å¦é€šè¿‡æ–‡ä»¶åè®®ï¼ˆfile://ï¼‰æ‰“å¼€é¡µé¢

### Q3: å¦‚ä½•å®Œå…¨ç¦ç”¨ HMRï¼Ÿ
**A**: åœ¨ `vue.config.js` ä¸­æ·»åŠ ï¼š
```javascript
devServer: {
  hot: false,
  liveReload: false,
}
```

### Q4: ç”Ÿäº§ç¯å¢ƒä¼šæœ‰è¿™ä¸ªé—®é¢˜å—ï¼Ÿ
**A**: ä¸ä¼šã€‚ç”Ÿäº§ç¯å¢ƒï¼ˆnpm run buildï¼‰ä¸åŒ…å« HMR ä»£ç ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Webpack DevServer é…ç½®](https://webpack.js.org/configuration/dev-server/)
- [Vue CLI DevServer](https://cli.vuejs.org/config/#devserver)
- [SockJS åè®®](https://github.com/sockjs/sockjs-protocol)

---

## æ€»ç»“

âœ… **å·²ä¿®å¤**ï¼šæ³¨é‡Šæ‰ `public: 'h5.chsg.com:8080'` é…ç½®
âœ… **ä½¿ç”¨æ–¹å¼**ï¼šé€šè¿‡ localhost:8080 è®¿é—®
âœ… **HMR çŠ¶æ€**ï¼šçƒ­æ›´æ–°æ­£å¸¸å·¥ä½œ
âœ… **å…¼å®¹æ€§**ï¼šæ”¯æŒå„ç§è®¿é—®æ–¹å¼ï¼ˆlocalhostã€127.0.0.1ã€å±€åŸŸç½‘IPï¼‰

**å¦‚éœ€æ¢å¤åŸŸåè®¿é—®**ï¼šå‚è€ƒ `HBuilderXæœ¬åœ°åŸŸåè°ƒè¯•å®Œæ•´é…ç½®.md` æ–‡æ¡£ã€‚
