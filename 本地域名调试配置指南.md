# 本地域名调试配置指南

## 概述

本指南将帮助您在 HBuilderX 开发调试时使用实际域名而不是 localhost，这样可以真实模拟对接后台的相关设置。

## 配置步骤

### 1. 修改 hosts 文件

#### Windows 系统
1. 以管理员身份打开记事本
2. 打开文件：`C:\Windows\System32\drivers\etc\hosts`
3. 在文件末尾添加以下内容：

```
# 本地开发域名配置
127.0.0.1 dev.yourdomain.com
127.0.0.1 local.yourdomain.com
```

#### macOS/Linux 系统
1. 打开终端
2. 编辑 hosts 文件：
```bash
sudo nano /etc/hosts
```
3. 在文件末尾添加：
```
# 本地开发域名配置
127.0.0.1 dev.yourdomain.com
127.0.0.1 local.yourdomain.com
```

### 2. 修改项目配置

#### 2.1 manifest.json 配置
```json
{
  "h5": {
    "devServer": {
      "https": false,
      "host": "0.0.0.0",
      "port": 8080,
      "disableHostCheck": true
    }
  }
}
```

#### 2.2 vue.config.js 配置
```javascript
module.exports = {
  devServer: {
    host: '0.0.0.0',  // 允许外部访问
    port: 8080,       // 端口号
    disableHostCheck: true,  // 禁用主机检查
    proxy: {
      '/api': {
        target: 'http://adm.jys.com',
        changeOrigin: true,
        pathRewrite: { '^/api': '' },
      },
    },
  },
};
```

### 3. 启动开发服务器

#### 方法一：使用 HBuilderX
1. 在 HBuilderX 中打开项目
2. 点击"运行" -> "运行到浏览器" -> "Chrome"
3. 项目将在 `http://dev.yourdomain.com:8080` 启动

#### 方法二：使用命令行
```bash
# 进入项目目录
cd /www/wwwroot/chsgappV2

# 安装依赖（如果还没有安装）
npm install

# 启动开发服务器
npm run dev:h5
```

### 4. 访问地址

配置完成后，您可以通过以下地址访问：
- `http://dev.yourdomain.com:8080/#/copage/chat`
- `http://local.yourdomain.com:8080/#/copage/chat`

## 配置说明

### hosts 文件作用
- 将域名映射到本地 IP 地址
- 让浏览器认为访问的是真实域名
- 模拟生产环境的域名访问

### devServer 配置说明
- `host: '0.0.0.0'`: 允许外部访问，不限制只能本地访问
- `port: 8080`: 指定端口号
- `disableHostCheck: true`: 禁用主机检查，允许使用自定义域名

### proxy 配置说明
- 将 `/api` 请求代理到后端服务器
- `changeOrigin: true`: 改变请求头中的 origin
- `pathRewrite`: 重写请求路径

## 常见问题

### 1. hosts 文件修改后不生效
**解决方案：**
- 清除浏览器缓存
- 重启浏览器
- 检查 hosts 文件格式是否正确

### 2. 端口被占用
**解决方案：**
- 修改 vue.config.js 中的 port 配置
- 或者杀死占用端口的进程

### 3. 代理不生效
**解决方案：**
- 检查 proxy 配置是否正确
- 确认后端服务器地址是否正确
- 查看浏览器控制台是否有错误

## 优势

### 1. 真实环境模拟
- 使用真实域名，更接近生产环境
- 可以测试域名相关的功能
- 便于调试跨域问题

### 2. 开发效率提升
- 避免 localhost 和真实域名的差异
- 便于团队协作开发
- 便于测试和调试

### 3. 配置灵活性
- 可以轻松切换不同的测试域名
- 便于配置不同的代理规则
- 支持多环境开发

## 注意事项

1. **hosts 文件权限**：修改 hosts 文件需要管理员权限
2. **域名选择**：选择不会与真实域名冲突的测试域名
3. **端口冲突**：确保选择的端口没有被其他服务占用
4. **代理配置**：根据实际后端地址调整代理配置

## 示例配置

### 完整的 hosts 配置示例
```
# 本地开发域名配置
127.0.0.1 dev.sg.com
127.0.0.1 local.sg.com
127.0.0.1 test.sg.com
```

### 完整的 vue.config.js 配置示例
```javascript
module.exports = {
  devServer: {
    host: '0.0.0.0',
    port: 8080,
    disableHostCheck: true,
    proxy: {
      '/api': {
        target: 'http://adm.jys.com',
        changeOrigin: true,
        pathRewrite: { '^/api': '' },
        logLevel: 'debug'  // 开启代理日志
      },
      '/upload': {
        target: 'http://adm.jys.com',
        changeOrigin: true,
        pathRewrite: { '^/upload': '/upload' }
      }
    }
  }
};
```

通过以上配置，您就可以在 HBuilderX 开发调试时使用实际域名，真实模拟对接后台的相关设置。
